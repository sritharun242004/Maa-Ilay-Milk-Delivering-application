{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { PrismaNeon } from '@prisma/adapter-neon'\nimport { neonConfig } from '@neondatabase/serverless'\n\n// Configure WebSocket for non-edge environments\nif (typeof globalThis.WebSocket === 'undefined') {\n  // eslint-disable-next-line @typescript-eslint/no-require-imports\n  neonConfig.webSocketConstructor = require('ws')\n}\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nfunction createPrismaClient() {\n  const connectionString = process.env.DATABASE_URL!\n  const adapter = new PrismaNeon({ connectionString })\n  \n  return new PrismaClient({\n    adapter,\n    log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],\n  })\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n\nexport default prisma\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,gDAAgD;AAChD,IAAI,OAAO,WAAW,SAAS,KAAK,aAAa;IAC/C,iEAAiE;IACjE,sKAAU,CAAC,oBAAoB;AACjC;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACP,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,MAAM,UAAU,IAAI,6KAAU,CAAC;QAAE;IAAiB;IAElD,OAAO,IAAI,sMAAY,CAAC;QACtB;QACA,KAAK,uCAAyC;YAAC;YAAS;SAAO,GAAG;IACpE;AACF;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\"\nimport GoogleProvider from \"next-auth/providers/google\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport bcrypt from \"bcryptjs\"\nimport prisma from \"./prisma\"\n\nexport type UserRole = \"customer\" | \"admin\" | \"delivery\"\n\ndeclare module \"next-auth\" {\n  interface User {\n    id: string\n    role: UserRole\n    phone?: string\n    status?: string\n  }\n  \n  interface Session {\n    user: {\n      id: string\n      name?: string | null\n      email?: string | null\n      image?: string | null\n      role: UserRole\n      phone?: string\n      status?: string\n    }\n  }\n}\n\ndeclare module \"next-auth/jwt\" {\n  interface JWT {\n    id: string\n    role: UserRole\n    phone?: string\n    status?: string\n  }\n}\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    // Google OAuth for Customers\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      authorization: {\n        params: {\n          prompt: \"consent\",\n          access_type: \"offline\",\n          response_type: \"code\"\n        }\n      }\n    }),\n    \n    // Credentials for Admin\n    CredentialsProvider({\n      id: \"admin-credentials\",\n      name: \"Admin Login\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Email and password are required\")\n        }\n\n        const admin = await prisma.admin.findUnique({\n          where: { email: credentials.email }\n        })\n\n        if (!admin || !admin.isActive) {\n          throw new Error(\"Invalid credentials or account disabled\")\n        }\n\n        const isValid = await bcrypt.compare(credentials.password, admin.password)\n        \n        if (!isValid) {\n          throw new Error(\"Invalid credentials\")\n        }\n\n        // Update last login\n        await prisma.admin.update({\n          where: { id: admin.id },\n          data: { lastLoginAt: new Date() }\n        })\n\n        return {\n          id: admin.id,\n          name: admin.name,\n          email: admin.email,\n          role: \"admin\" as UserRole\n        }\n      }\n    }),\n    \n    // Credentials for Delivery Person\n    CredentialsProvider({\n      id: \"delivery-credentials\",\n      name: \"Delivery Login\",\n      credentials: {\n        phone: { label: \"Phone Number\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.phone || !credentials?.password) {\n          throw new Error(\"Phone number and password are required\")\n        }\n\n        // Clean phone number (remove spaces, dashes, country code)\n        const phone = credentials.phone.replace(/\\D/g, '').slice(-10)\n\n        const deliveryPerson = await prisma.deliveryPerson.findUnique({\n          where: { phone }\n        })\n\n        if (!deliveryPerson || !deliveryPerson.isActive) {\n          throw new Error(\"Invalid credentials or account disabled\")\n        }\n\n        const isValid = await bcrypt.compare(credentials.password, deliveryPerson.password)\n        \n        if (!isValid) {\n          throw new Error(\"Invalid credentials\")\n        }\n\n        // Update last login\n        await prisma.deliveryPerson.update({\n          where: { id: deliveryPerson.id },\n          data: { lastLoginAt: new Date() }\n        })\n\n        return {\n          id: deliveryPerson.id,\n          name: deliveryPerson.name,\n          phone: deliveryPerson.phone,\n          role: \"delivery\" as UserRole\n        }\n      }\n    })\n  ],\n  \n  callbacks: {\n    async signIn({ user, account }) {\n      // For Google sign-in (customers)\n      if (account?.provider === \"google\") {\n        try {\n          // Check if customer exists\n          const existingCustomer = await prisma.customer.findUnique({\n            where: { email: user.email! }\n          })\n\n          if (existingCustomer) {\n            // Update role info for existing customer\n            user.role = \"customer\"\n            user.id = existingCustomer.id\n            user.status = existingCustomer.status\n          } else {\n            // New customer - will need to complete profile\n            user.role = \"customer\"\n            user.status = \"NEW\"\n          }\n          return true\n        } catch (error) {\n          console.error(\"SignIn error:\", error)\n          return true // Still allow sign-in, jwt callback will handle status\n        }\n      }\n\n      return true\n    },\n\n    async jwt({ token, user, account, trigger }) {\n      if (user) {\n        token.id = user.id\n        token.role = user.role\n        token.phone = user.phone\n        token.status = user.status\n      }\n\n      // For Google sign-in, check if user exists in database\n      if (account?.provider === \"google\" && token.email) {\n        const customer = await prisma.customer.findUnique({\n          where: { email: token.email }\n        })\n\n        if (customer) {\n          token.id = customer.id\n          token.role = \"customer\"\n          token.status = customer.status\n          token.phone = customer.phone\n        } else {\n          // New user - needs to complete registration\n          token.role = \"customer\"\n          token.status = \"NEW\"\n        }\n      }\n\n      // Refresh customer status on session update\n      if (trigger === \"update\" && token.role === \"customer\" && token.id) {\n        const customer = await prisma.customer.findUnique({\n          where: { id: token.id }\n        })\n        if (customer) {\n          token.status = customer.status\n        }\n      }\n\n      return token\n    },\n\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id\n        session.user.role = token.role\n        session.user.phone = token.phone\n        session.user.status = token.status\n      }\n      return session\n    },\n\n    async redirect({ url, baseUrl }) {\n      // Handle callback URLs properly\n      if (url.startsWith(\"/\")) {\n        return `${baseUrl}${url}`\n      }\n      if (url.startsWith(baseUrl)) {\n        return url\n      }\n      // Default to customer dashboard for Google sign-in\n      return `${baseUrl}/customer`\n    }\n  },\n\n  pages: {\n    signIn: \"/login\",\n    error: \"/login\",\n  },\n\n  session: {\n    strategy: \"jwt\",\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n\n  secret: process.env.NEXTAUTH_SECRET,\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 388, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/api-utils.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { getServerSession } from \"next-auth\"\nimport { authOptions, UserRole } from \"./auth\"\nimport { ZodError } from \"zod\"\n\n// API Response helpers\nexport function successResponse<T>(data: T, status = 200) {\n  return NextResponse.json({ success: true, data }, { status })\n}\n\nexport function errorResponse(message: string, status = 400) {\n  return NextResponse.json({ success: false, error: message }, { status })\n}\n\nexport function validationError(error: ZodError) {\n  const messages = error.errors.map((e) => e.message).join(\", \")\n  return errorResponse(messages, 400)\n}\n\n// Auth helpers\nexport async function getSession() {\n  return getServerSession(authOptions)\n}\n\nexport async function requireAuth(allowedRoles?: UserRole[]) {\n  const session = await getSession()\n  \n  if (!session?.user) {\n    return { error: errorResponse(\"Unauthorized\", 401), session: null }\n  }\n\n  if (allowedRoles && !allowedRoles.includes(session.user.role)) {\n    return { error: errorResponse(\"Forbidden\", 403), session: null }\n  }\n\n  return { error: null, session }\n}\n\nexport async function requireAdmin() {\n  return requireAuth([\"admin\"])\n}\n\nexport async function requireDelivery() {\n  return requireAuth([\"delivery\"])\n}\n\nexport async function requireCustomer() {\n  return requireAuth([\"customer\"])\n}\n\n// Cron job authorization\nexport function verifyCronSecret(request: Request): boolean {\n  const authHeader = request.headers.get(\"authorization\")\n  const cronSecret = process.env.CRON_SECRET\n  \n  if (!cronSecret) {\n    console.error(\"CRON_SECRET not configured\")\n    return false\n  }\n\n  return authHeader === `Bearer ${cronSecret}`\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAIO,SAAS,gBAAmB,IAAO,EAAE,SAAS,GAAG;IACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAM;IAAK,GAAG;QAAE;IAAO;AAC7D;AAEO,SAAS,cAAc,OAAe,EAAE,SAAS,GAAG;IACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxE;AAEO,SAAS,gBAAgB,KAAe;IAC7C,MAAM,WAAW,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,IAAM,EAAE,OAAO,EAAE,IAAI,CAAC;IACzD,OAAO,cAAc,UAAU;AACjC;AAGO,eAAe;IACpB,OAAO,IAAA,2JAAgB,EAAC,mIAAW;AACrC;AAEO,eAAe,YAAY,YAAyB;IACzD,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS,MAAM;QAClB,OAAO;YAAE,OAAO,cAAc,gBAAgB;YAAM,SAAS;QAAK;IACpE;IAEA,IAAI,gBAAgB,CAAC,aAAa,QAAQ,CAAC,QAAQ,IAAI,CAAC,IAAI,GAAG;QAC7D,OAAO;YAAE,OAAO,cAAc,aAAa;YAAM,SAAS;QAAK;IACjE;IAEA,OAAO;QAAE,OAAO;QAAM;IAAQ;AAChC;AAEO,eAAe;IACpB,OAAO,YAAY;QAAC;KAAQ;AAC9B;AAEO,eAAe;IACpB,OAAO,YAAY;QAAC;KAAW;AACjC;AAEO,eAAe;IACpB,OAAO,YAAY;QAAC;KAAW;AACjC;AAGO,SAAS,iBAAiB,OAAgB;IAC/C,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW;IAE1C,IAAI,CAAC,YAAY;QACf,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IAEA,OAAO,eAAe,CAAC,OAAO,EAAE,YAAY;AAC9C"}},
    {"offset": {"line": 484, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/app/api/admin/customers/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\"\nimport prisma from \"@/lib/prisma\"\nimport { successResponse, errorResponse, requireAdmin } from \"@/lib/api-utils\"\n\n// Get single customer details\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { error, session } = await requireAdmin()\n    if (error) return error\n\n    const { id } = await params\n\n    const customer = await prisma.customer.findUnique({\n      where: { id },\n      include: {\n        subscription: true,\n        wallet: {\n          include: {\n            transactions: {\n              orderBy: { createdAt: \"desc\" },\n              take: 50\n            }\n          }\n        },\n        deliveryPerson: true,\n        deliveries: {\n          orderBy: { deliveryDate: \"desc\" },\n          take: 30\n        },\n        pauses: {\n          orderBy: { pauseDate: \"desc\" },\n          take: 30\n        },\n        bottleLedger: {\n          orderBy: { createdAt: \"desc\" },\n          take: 50\n        }\n      }\n    })\n\n    if (!customer) {\n      return errorResponse(\"Customer not found\", 404)\n    }\n\n    // Calculate bottle balance\n    const latestBottleEntry = customer.bottleLedger[0]\n    const bottleBalance = {\n      large: latestBottleEntry?.largeBottleBalanceAfter ?? 0,\n      small: latestBottleEntry?.smallBottleBalanceAfter ?? 0\n    }\n\n    return successResponse({ customer, bottleBalance })\n\n  } catch (err) {\n    console.error(\"Get customer error:\", err)\n    return errorResponse(\"Failed to fetch customer\", 500)\n  }\n}\n\n// Update customer\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { error, session } = await requireAdmin()\n    if (error) return error\n\n    const { id } = await params\n    const body = await request.json()\n\n    const {\n      name,\n      phone,\n      addressLine1,\n      addressLine2,\n      landmark,\n      city,\n      pincode,\n      deliveryPersonId,\n      deliveryNotes,\n      status\n    } = body\n\n    // Get current customer for audit\n    const currentCustomer = await prisma.customer.findUnique({\n      where: { id }\n    })\n\n    if (!currentCustomer) {\n      return errorResponse(\"Customer not found\", 404)\n    }\n\n    // Update customer\n    const customer = await prisma.customer.update({\n      where: { id },\n      data: {\n        ...(name && { name }),\n        ...(phone && { phone }),\n        ...(addressLine1 && { addressLine1 }),\n        ...(addressLine2 !== undefined && { addressLine2 }),\n        ...(landmark !== undefined && { landmark }),\n        ...(city && { city }),\n        ...(pincode && { pincode }),\n        ...(deliveryPersonId && { deliveryPersonId }),\n        ...(deliveryNotes !== undefined && { deliveryNotes }),\n        ...(status && { status })\n      }\n    })\n\n    // Create audit log\n    await prisma.adminAuditLog.create({\n      data: {\n        adminId: session!.user.id,\n        action: \"customer_updated\",\n        entityType: \"customer\",\n        entityId: id,\n        oldValue: currentCustomer as any,\n        newValue: customer as any\n      }\n    })\n\n    return successResponse({ customer })\n\n  } catch (err) {\n    console.error(\"Update customer error:\", err)\n    return errorResponse(\"Failed to update customer\", 500)\n  }\n}\n"],"names":[],"mappings":"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"}}]
}