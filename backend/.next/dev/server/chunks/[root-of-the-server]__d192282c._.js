module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[project]/src/lib/prisma.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>__TURBOPACK__default__export__,
    "prisma",
    ()=>prisma
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs, [project]/node_modules/@prisma/client)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$neon$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@prisma/adapter-neon/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$neondatabase$2f$serverless$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@neondatabase/serverless/index.mjs [app-route] (ecmascript)");
;
;
;
// Configure WebSocket for non-edge environments
if (typeof globalThis.WebSocket === 'undefined') {
    // eslint-disable-next-line @typescript-eslint/no-require-imports
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$neondatabase$2f$serverless$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["neonConfig"].webSocketConstructor = __turbopack_context__.r("[project]/node_modules/ws/index.js [app-route] (ecmascript)");
}
const globalForPrisma = globalThis;
function createPrismaClient() {
    const connectionString = process.env.DATABASE_URL;
    const adapter = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$neon$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaNeon"]({
        connectionString
    });
    return new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__["PrismaClient"]({
        adapter,
        log: ("TURBOPACK compile-time truthy", 1) ? [
            'error',
            'warn'
        ] : "TURBOPACK unreachable"
    });
}
const prisma = globalForPrisma.prisma ?? createPrismaClient();
if ("TURBOPACK compile-time truthy", 1) globalForPrisma.prisma = prisma;
const __TURBOPACK__default__export__ = prisma;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/querystring [external] (querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}),
"[project]/src/lib/auth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "authOptions",
    ()=>authOptions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/google.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/credentials.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/bcryptjs/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/prisma.ts [app-route] (ecmascript)");
;
;
;
;
const authOptions = {
    providers: [
        // Google OAuth for Customers
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            clientId: process.env.GOOGLE_CLIENT_ID,
            clientSecret: process.env.GOOGLE_CLIENT_SECRET,
            authorization: {
                params: {
                    prompt: "consent",
                    access_type: "offline",
                    response_type: "code"
                }
            }
        }),
        // Credentials for Admin
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            id: "admin-credentials",
            name: "Admin Login",
            credentials: {
                email: {
                    label: "Email",
                    type: "email"
                },
                password: {
                    label: "Password",
                    type: "password"
                }
            },
            async authorize (credentials) {
                if (!credentials?.email || !credentials?.password) {
                    throw new Error("Email and password are required");
                }
                const admin = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].admin.findUnique({
                    where: {
                        email: credentials.email
                    }
                });
                if (!admin || !admin.isActive) {
                    throw new Error("Invalid credentials or account disabled");
                }
                const isValid = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].compare(credentials.password, admin.password);
                if (!isValid) {
                    throw new Error("Invalid credentials");
                }
                // Update last login
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].admin.update({
                    where: {
                        id: admin.id
                    },
                    data: {
                        lastLoginAt: new Date()
                    }
                });
                return {
                    id: admin.id,
                    name: admin.name,
                    email: admin.email,
                    role: "admin"
                };
            }
        }),
        // Credentials for Delivery Person
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            id: "delivery-credentials",
            name: "Delivery Login",
            credentials: {
                phone: {
                    label: "Phone Number",
                    type: "text"
                },
                password: {
                    label: "Password",
                    type: "password"
                }
            },
            async authorize (credentials) {
                if (!credentials?.phone || !credentials?.password) {
                    throw new Error("Phone number and password are required");
                }
                // Clean phone number (remove spaces, dashes, country code)
                const phone = credentials.phone.replace(/\D/g, '').slice(-10);
                const deliveryPerson = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].deliveryPerson.findUnique({
                    where: {
                        phone
                    }
                });
                if (!deliveryPerson || !deliveryPerson.isActive) {
                    throw new Error("Invalid credentials or account disabled");
                }
                const isValid = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].compare(credentials.password, deliveryPerson.password);
                if (!isValid) {
                    throw new Error("Invalid credentials");
                }
                // Update last login
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].deliveryPerson.update({
                    where: {
                        id: deliveryPerson.id
                    },
                    data: {
                        lastLoginAt: new Date()
                    }
                });
                return {
                    id: deliveryPerson.id,
                    name: deliveryPerson.name,
                    phone: deliveryPerson.phone,
                    role: "delivery"
                };
            }
        })
    ],
    callbacks: {
        async signIn ({ user, account }) {
            // For Google sign-in (customers)
            if (account?.provider === "google") {
                // Check if customer exists
                const existingCustomer = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].customer.findUnique({
                    where: {
                        email: user.email
                    }
                });
                if (existingCustomer) {
                    // Update role info for existing customer
                    user.role = "customer";
                    user.id = existingCustomer.id;
                    user.status = existingCustomer.status;
                    return true;
                }
                // New customer - will need to complete profile
                user.role = "customer";
                return true;
            }
            return true;
        },
        async jwt ({ token, user, account, trigger }) {
            if (user) {
                token.id = user.id;
                token.role = user.role;
                token.phone = user.phone;
                token.status = user.status;
            }
            // For Google sign-in, check if user exists in database
            if (account?.provider === "google" && token.email) {
                const customer = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].customer.findUnique({
                    where: {
                        email: token.email
                    }
                });
                if (customer) {
                    token.id = customer.id;
                    token.role = "customer";
                    token.status = customer.status;
                    token.phone = customer.phone;
                } else {
                    // New user - needs to complete registration
                    token.role = "customer";
                    token.status = "NEW";
                }
            }
            // Refresh customer status on session update
            if (trigger === "update" && token.role === "customer" && token.id) {
                const customer = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].customer.findUnique({
                    where: {
                        id: token.id
                    }
                });
                if (customer) {
                    token.status = customer.status;
                }
            }
            return token;
        },
        async session ({ session, token }) {
            if (session.user) {
                session.user.id = token.id;
                session.user.role = token.role;
                session.user.phone = token.phone;
                session.user.status = token.status;
            }
            return session;
        },
        async redirect ({ url, baseUrl }) {
            // Redirect based on role after sign in
            if (url.startsWith(baseUrl)) {
                return url;
            }
            return baseUrl;
        }
    },
    pages: {
        signIn: "/login",
        error: "/login"
    },
    session: {
        strategy: "jwt",
        maxAge: 30 * 24 * 60 * 60
    },
    secret: process.env.NEXTAUTH_SECRET
};
}),
"[project]/src/lib/api-utils.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "errorResponse",
    ()=>errorResponse,
    "getSession",
    ()=>getSession,
    "requireAdmin",
    ()=>requireAdmin,
    "requireAuth",
    ()=>requireAuth,
    "requireCustomer",
    ()=>requireCustomer,
    "requireDelivery",
    ()=>requireDelivery,
    "successResponse",
    ()=>successResponse,
    "validationError",
    ()=>validationError,
    "verifyCronSecret",
    ()=>verifyCronSecret
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/auth.ts [app-route] (ecmascript)");
;
;
;
function successResponse(data, status = 200) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        success: true,
        data
    }, {
        status
    });
}
function errorResponse(message, status = 400) {
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        success: false,
        error: message
    }, {
        status
    });
}
function validationError(error) {
    const messages = error.errors.map((e)=>e.message).join(", ");
    return errorResponse(messages, 400);
}
async function getSession() {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
}
async function requireAuth(allowedRoles) {
    const session = await getSession();
    if (!session?.user) {
        return {
            error: errorResponse("Unauthorized", 401),
            session: null
        };
    }
    if (allowedRoles && !allowedRoles.includes(session.user.role)) {
        return {
            error: errorResponse("Forbidden", 403),
            session: null
        };
    }
    return {
        error: null,
        session
    };
}
async function requireAdmin() {
    return requireAuth([
        "admin"
    ]);
}
async function requireDelivery() {
    return requireAuth([
        "delivery"
    ]);
}
async function requireCustomer() {
    return requireAuth([
        "customer"
    ]);
}
function verifyCronSecret(request) {
    const authHeader = request.headers.get("authorization");
    const cronSecret = process.env.CRON_SECRET;
    if (!cronSecret) {
        console.error("CRON_SECRET not configured");
        return false;
    }
    return authHeader === `Bearer ${cronSecret}`;
}
}),
"[project]/src/lib/constants.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// ==================== PRICING CONSTANTS ====================
// Milk pricing (in paise - 100 paise = 1 rupee)
__turbopack_context__.s([
    "CUSTOMER_STATUS_LABELS",
    ()=>CUSTOMER_STATUS_LABELS,
    "CUTOFF_HOUR",
    ()=>CUTOFF_HOUR,
    "CUTOFF_MINUTE",
    ()=>CUTOFF_MINUTE,
    "DELIVERY_HOUR",
    ()=>DELIVERY_HOUR,
    "DELIVERY_STATUS_LABELS",
    ()=>DELIVERY_STATUS_LABELS,
    "DEPOSIT_CYCLE_MONTHS",
    ()=>DEPOSIT_CYCLE_MONTHS,
    "DEPOSIT_LARGE_BOTTLE_PAISE",
    ()=>DEPOSIT_LARGE_BOTTLE_PAISE,
    "DEPOSIT_SMALL_BOTTLE_PAISE",
    ()=>DEPOSIT_SMALL_BOTTLE_PAISE,
    "GRACE_PERIOD_DAYS",
    ()=>GRACE_PERIOD_DAYS,
    "MAX_DAILY_QUANTITY_ML",
    ()=>MAX_DAILY_QUANTITY_ML,
    "MAX_PAUSE_DAYS_PER_MONTH",
    ()=>MAX_PAUSE_DAYS_PER_MONTH,
    "MILK_PRICE_PER_500ML_PAISE",
    ()=>MILK_PRICE_PER_500ML_PAISE,
    "MILK_PRICE_PER_LITER_PAISE",
    ()=>MILK_PRICE_PER_LITER_PAISE,
    "MIN_DAILY_QUANTITY_ML",
    ()=>MIN_DAILY_QUANTITY_ML,
    "MIN_SUBSCRIPTION_MONTHS",
    ()=>MIN_SUBSCRIPTION_MONTHS,
    "PENALTY_LARGE_BOTTLE_PAISE",
    ()=>PENALTY_LARGE_BOTTLE_PAISE,
    "PENALTY_SMALL_BOTTLE_PAISE",
    ()=>PENALTY_SMALL_BOTTLE_PAISE,
    "PENALTY_TRIGGER_DAYS",
    ()=>PENALTY_TRIGGER_DAYS,
    "QUANTITY_OPTIONS",
    ()=>QUANTITY_OPTIONS,
    "QUANTITY_STEP_ML",
    ()=>QUANTITY_STEP_ML,
    "TIMEZONE",
    ()=>TIMEZONE,
    "calculateBottleComposition",
    ()=>calculateBottleComposition,
    "calculateDailyPrice",
    ()=>calculateDailyPrice,
    "calculateDepositAmount",
    ()=>calculateDepositAmount,
    "calculateMonthlyTotal",
    ()=>calculateMonthlyTotal,
    "formatPaise",
    ()=>formatPaise,
    "formatQuantity",
    ()=>formatQuantity,
    "isDepositDue",
    ()=>isDepositDue
]);
const MILK_PRICE_PER_LITER_PAISE = 11000 // ₹110 per liter
;
const MILK_PRICE_PER_500ML_PAISE = 5500 // ₹55 per 500ml
;
const DEPOSIT_LARGE_BOTTLE_PAISE = 3500 // ₹35 for 1L bottle
;
const DEPOSIT_SMALL_BOTTLE_PAISE = 2500 // ₹25 for 500ml bottle
;
const PENALTY_LARGE_BOTTLE_PAISE = 3500 // ₹35 penalty
;
const PENALTY_SMALL_BOTTLE_PAISE = 2500 // ₹25 penalty
;
const MIN_DAILY_QUANTITY_ML = 500;
const MAX_DAILY_QUANTITY_ML = 3000;
const QUANTITY_STEP_ML = 500;
const DEPOSIT_CYCLE_MONTHS = 3 // Deposit every 3 months
;
const MIN_SUBSCRIPTION_MONTHS = 1;
const MAX_PAUSE_DAYS_PER_MONTH = 5;
const CUTOFF_HOUR = 17 // 5 PM in 24-hour format
;
const CUTOFF_MINUTE = 0;
const DELIVERY_HOUR = 6 // 6 AM
;
const GRACE_PERIOD_DAYS = 1;
const PENALTY_TRIGGER_DAYS = 7;
const TIMEZONE = 'Asia/Kolkata';
function calculateBottleComposition(quantityMl) {
    const largeBottles = Math.floor(quantityMl / 1000);
    const remainingMl = quantityMl % 1000;
    const smallBottles = remainingMl >= 500 ? 1 : 0;
    return {
        largeBottles,
        smallBottles
    };
}
function calculateDailyPrice(quantityMl) {
    const { largeBottles, smallBottles } = calculateBottleComposition(quantityMl);
    return largeBottles * MILK_PRICE_PER_LITER_PAISE + smallBottles * MILK_PRICE_PER_500ML_PAISE;
}
function calculateDepositAmount(quantityMl) {
    const { largeBottles, smallBottles } = calculateBottleComposition(quantityMl);
    return largeBottles * DEPOSIT_LARGE_BOTTLE_PAISE + smallBottles * DEPOSIT_SMALL_BOTTLE_PAISE;
}
function calculateMonthlyTotal(quantityMl, daysInMonth, includeDeposit) {
    const dailyPrice = calculateDailyPrice(quantityMl);
    const milkTotal = dailyPrice * daysInMonth;
    const depositTotal = includeDeposit ? calculateDepositAmount(quantityMl) : 0;
    return {
        milkTotal,
        depositTotal,
        grandTotal: milkTotal + depositTotal
    };
}
function isDepositDue(paymentCycleCount) {
    // Deposit on month 1, 4, 7, 10... (every 3 months)
    return paymentCycleCount % DEPOSIT_CYCLE_MONTHS === 1;
}
const QUANTITY_OPTIONS = [
    {
        value: 500,
        label: '500ml',
        bottles: '1 small bottle'
    },
    {
        value: 1000,
        label: '1 Liter',
        bottles: '1 large bottle'
    },
    {
        value: 1500,
        label: '1.5 Liters',
        bottles: '1 large + 1 small bottle'
    },
    {
        value: 2000,
        label: '2 Liters',
        bottles: '2 large bottles'
    },
    {
        value: 2500,
        label: '2.5 Liters',
        bottles: '2 large + 1 small bottle'
    },
    {
        value: 3000,
        label: '3 Liters',
        bottles: '3 large bottles'
    }
];
const CUSTOMER_STATUS_LABELS = {
    PENDING_APPROVAL: 'Pending Approval',
    PENDING_PAYMENT: 'Awaiting Payment',
    ACTIVE: 'Active',
    PAUSED: 'Paused',
    BLOCKED: 'Blocked',
    INACTIVE: 'Inactive'
};
const DELIVERY_STATUS_LABELS = {
    SCHEDULED: 'Scheduled',
    DELIVERED: 'Delivered',
    NOT_DELIVERED: 'Not Delivered',
    PAUSED: 'Paused',
    BLOCKED: 'Blocked',
    HOLIDAY: 'Holiday'
};
function formatPaise(paise) {
    const rupees = paise / 100;
    return new Intl.NumberFormat('en-IN', {
        style: 'currency',
        currency: 'INR',
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
    }).format(rupees);
}
function formatQuantity(ml) {
    if (ml >= 1000) {
        const liters = ml / 1000;
        return `${liters}L`;
    }
    return `${ml}ml`;
}
}),
"[project]/src/lib/utils.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "cn",
    ()=>cn,
    "daysDifference",
    ()=>daysDifference,
    "formatDate",
    ()=>formatDate,
    "formatDateShort",
    ()=>formatDateShort,
    "formatDateTime",
    ()=>formatDateTime,
    "formatPhone",
    ()=>formatPhone,
    "generatePassword",
    ()=>generatePassword,
    "getCurrentMonthRange",
    ()=>getCurrentMonthRange,
    "getCurrentMonthYear",
    ()=>getCurrentMonthYear,
    "getDaysInMonth",
    ()=>getDaysInMonth,
    "getEarliestPausableDate",
    ()=>getEarliestPausableDate,
    "getISTDate",
    ()=>getISTDate,
    "getISTDateString",
    ()=>getISTDateString,
    "getMonthDates",
    ()=>getMonthDates,
    "getTomorrowIST",
    ()=>getTomorrowIST,
    "isPastCutoff",
    ()=>isPastCutoff,
    "isSameDay",
    ()=>isSameDay,
    "isValidIndianPhone",
    ()=>isValidIndianPhone,
    "isValidPincode",
    ()=>isValidPincode,
    "parseISTDate",
    ()=>parseISTDate,
    "slugify",
    ()=>slugify
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$clsx$2f$dist$2f$clsx$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/clsx/dist/clsx.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$tailwind$2d$merge$2f$dist$2f$bundle$2d$mjs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/tailwind-merge/dist/bundle-mjs.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/constants.ts [app-route] (ecmascript)");
;
;
;
function cn(...inputs) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$tailwind$2d$merge$2f$dist$2f$bundle$2d$mjs$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["twMerge"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$clsx$2f$dist$2f$clsx$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["clsx"])(inputs));
}
function getISTDate() {
    return new Date(new Date().toLocaleString('en-US', {
        timeZone: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TIMEZONE"]
    }));
}
function getISTDateString(date) {
    const d = date || new Date();
    return d.toLocaleDateString('en-CA', {
        timeZone: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TIMEZONE"]
    }) // en-CA gives YYYY-MM-DD format
    ;
}
function parseISTDate(dateString) {
    const [year, month, day] = dateString.split('-').map(Number);
    return new Date(year, month - 1, day);
}
function isPastCutoff() {
    const now = getISTDate();
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    return currentHour > __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["CUTOFF_HOUR"] || currentHour === __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["CUTOFF_HOUR"] && currentMinute >= __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["CUTOFF_MINUTE"];
}
function getEarliestPausableDate() {
    const today = getISTDate();
    today.setHours(0, 0, 0, 0);
    // If past cutoff, can't pause tomorrow, only day after
    const daysToAdd = isPastCutoff() ? 2 : 1;
    today.setDate(today.getDate() + daysToAdd);
    return today;
}
function getTomorrowIST() {
    const tomorrow = getISTDate();
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);
    return tomorrow;
}
function getCurrentMonthYear() {
    const now = getISTDate();
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
}
function getDaysInMonth(year, month) {
    return new Date(year, month, 0).getDate();
}
function getCurrentMonthRange() {
    const now = getISTDate();
    const start = new Date(now.getFullYear(), now.getMonth(), 1);
    const end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    return {
        start,
        end
    };
}
function formatDate(date) {
    const d = typeof date === 'string' ? new Date(date) : date;
    return d.toLocaleDateString('en-IN', {
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        timeZone: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TIMEZONE"]
    });
}
function formatDateShort(date) {
    const d = typeof date === 'string' ? new Date(date) : date;
    return d.toLocaleDateString('en-IN', {
        day: 'numeric',
        month: 'short',
        timeZone: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TIMEZONE"]
    });
}
function formatDateTime(date) {
    const d = typeof date === 'string' ? new Date(date) : date;
    return d.toLocaleString('en-IN', {
        day: 'numeric',
        month: 'short',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true,
        timeZone: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["TIMEZONE"]
    });
}
function getMonthDates(year, month) {
    const dates = [];
    const daysInMonth = getDaysInMonth(year, month);
    for(let day = 1; day <= daysInMonth; day++){
        dates.push(new Date(year, month - 1, day));
    }
    return dates;
}
function isSameDay(date1, date2) {
    return date1.getFullYear() === date2.getFullYear() && date1.getMonth() === date2.getMonth() && date1.getDate() === date2.getDate();
}
function daysDifference(date1, date2) {
    const oneDay = 24 * 60 * 60 * 1000;
    return Math.round((date2.getTime() - date1.getTime()) / oneDay);
}
function isValidIndianPhone(phone) {
    const cleaned = phone.replace(/\D/g, '');
    return /^[6-9]\d{9}$/.test(cleaned);
}
function formatPhone(phone) {
    const cleaned = phone.replace(/\D/g, '');
    if (cleaned.length === 10) {
        return `+91 ${cleaned.slice(0, 5)} ${cleaned.slice(5)}`;
    }
    return phone;
}
function isValidPincode(pincode) {
    return /^[1-9][0-9]{5}$/.test(pincode);
}
function generatePassword(length = 8) {
    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let password = '';
    for(let i = 0; i < length; i++){
        password += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return password;
}
function slugify(text) {
    return text.toLowerCase().trim().replace(/[^\w\s-]/g, '').replace(/[\s_-]+/g, '-').replace(/^-+|-+$/g, '');
}
}),
"[project]/src/app/api/delivery/summary/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/prisma.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$api$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/api-utils.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/utils.ts [app-route] (ecmascript)");
;
;
;
async function GET() {
    try {
        const { error, session } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$api$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["requireDelivery"])();
        if (error) return error;
        const today = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getISTDate"])();
        today.setHours(0, 0, 0, 0);
        // Get all scheduled deliveries for today
        const deliveries = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].delivery.findMany({
            where: {
                deliveryPersonId: session.user.id,
                deliveryDate: today,
                status: "SCHEDULED"
            }
        });
        // Calculate totals
        const totalLargeBottles = deliveries.reduce((sum, d)=>sum + d.largeBottles, 0);
        const totalSmallBottles = deliveries.reduce((sum, d)=>sum + d.smallBottles, 0);
        const totalQuantityMl = deliveries.reduce((sum, d)=>sum + d.quantityMl, 0);
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$api$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["successResponse"])({
            date: today.toISOString().split('T')[0],
            loadSummary: {
                largeBottles: totalLargeBottles,
                smallBottles: totalSmallBottles,
                totalQuantityLiters: totalQuantityMl / 1000,
                totalDeliveries: deliveries.length
            }
        });
    } catch (err) {
        console.error("Get summary error:", err);
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$api$2d$utils$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["errorResponse"])("Failed to fetch summary", 500);
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__d192282c._.js.map