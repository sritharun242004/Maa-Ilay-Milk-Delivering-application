{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { PrismaNeon } from '@prisma/adapter-neon'\nimport { neonConfig } from '@neondatabase/serverless'\n\n// Configure WebSocket for non-edge environments\nif (typeof globalThis.WebSocket === 'undefined') {\n  // eslint-disable-next-line @typescript-eslint/no-require-imports\n  neonConfig.webSocketConstructor = require('ws')\n}\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nfunction createPrismaClient() {\n  const connectionString = process.env.DATABASE_URL!\n  const adapter = new PrismaNeon({ connectionString })\n  \n  return new PrismaClient({\n    adapter,\n    log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],\n  })\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n\nexport default prisma\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,gDAAgD;AAChD,IAAI,OAAO,WAAW,SAAS,KAAK,aAAa;IAC/C,iEAAiE;IACjE,sKAAU,CAAC,oBAAoB;AACjC;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACP,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,MAAM,UAAU,IAAI,6KAAU,CAAC;QAAE;IAAiB;IAElD,OAAO,IAAI,sMAAY,CAAC;QACtB;QACA,KAAK,uCAAyC;YAAC;YAAS;SAAO,GAAG;IACpE;AACF;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\"\nimport GoogleProvider from \"next-auth/providers/google\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport bcrypt from \"bcryptjs\"\nimport prisma from \"./prisma\"\n\nexport type UserRole = \"customer\" | \"admin\" | \"delivery\"\n\ndeclare module \"next-auth\" {\n  interface User {\n    id: string\n    role: UserRole\n    phone?: string\n    status?: string\n  }\n  \n  interface Session {\n    user: {\n      id: string\n      name?: string | null\n      email?: string | null\n      image?: string | null\n      role: UserRole\n      phone?: string\n      status?: string\n    }\n  }\n}\n\ndeclare module \"next-auth/jwt\" {\n  interface JWT {\n    id: string\n    role: UserRole\n    phone?: string\n    status?: string\n  }\n}\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    // Google OAuth for Customers\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      authorization: {\n        params: {\n          prompt: \"consent\",\n          access_type: \"offline\",\n          response_type: \"code\"\n        }\n      }\n    }),\n    \n    // Credentials for Admin\n    CredentialsProvider({\n      id: \"admin-credentials\",\n      name: \"Admin Login\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Email and password are required\")\n        }\n\n        const admin = await prisma.admin.findUnique({\n          where: { email: credentials.email }\n        })\n\n        if (!admin || !admin.isActive) {\n          throw new Error(\"Invalid credentials or account disabled\")\n        }\n\n        const isValid = await bcrypt.compare(credentials.password, admin.password)\n        \n        if (!isValid) {\n          throw new Error(\"Invalid credentials\")\n        }\n\n        // Update last login\n        await prisma.admin.update({\n          where: { id: admin.id },\n          data: { lastLoginAt: new Date() }\n        })\n\n        return {\n          id: admin.id,\n          name: admin.name,\n          email: admin.email,\n          role: \"admin\" as UserRole\n        }\n      }\n    }),\n    \n    // Credentials for Delivery Person\n    CredentialsProvider({\n      id: \"delivery-credentials\",\n      name: \"Delivery Login\",\n      credentials: {\n        phone: { label: \"Phone Number\", type: \"text\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.phone || !credentials?.password) {\n          throw new Error(\"Phone number and password are required\")\n        }\n\n        // Clean phone number (remove spaces, dashes, country code)\n        const phone = credentials.phone.replace(/\\D/g, '').slice(-10)\n\n        const deliveryPerson = await prisma.deliveryPerson.findUnique({\n          where: { phone }\n        })\n\n        if (!deliveryPerson || !deliveryPerson.isActive) {\n          throw new Error(\"Invalid credentials or account disabled\")\n        }\n\n        const isValid = await bcrypt.compare(credentials.password, deliveryPerson.password)\n        \n        if (!isValid) {\n          throw new Error(\"Invalid credentials\")\n        }\n\n        // Update last login\n        await prisma.deliveryPerson.update({\n          where: { id: deliveryPerson.id },\n          data: { lastLoginAt: new Date() }\n        })\n\n        return {\n          id: deliveryPerson.id,\n          name: deliveryPerson.name,\n          phone: deliveryPerson.phone,\n          role: \"delivery\" as UserRole\n        }\n      }\n    })\n  ],\n  \n  callbacks: {\n    async signIn({ user, account }) {\n      // For Google sign-in (customers)\n      if (account?.provider === \"google\") {\n        // Check if customer exists\n        const existingCustomer = await prisma.customer.findUnique({\n          where: { email: user.email! }\n        })\n\n        if (existingCustomer) {\n          // Update role info for existing customer\n          user.role = \"customer\"\n          user.id = existingCustomer.id\n          user.status = existingCustomer.status\n          return true\n        }\n\n        // New customer - will need to complete profile\n        user.role = \"customer\"\n        return true\n      }\n\n      return true\n    },\n\n    async jwt({ token, user, account, trigger }) {\n      if (user) {\n        token.id = user.id\n        token.role = user.role\n        token.phone = user.phone\n        token.status = user.status\n      }\n\n      // For Google sign-in, check if user exists in database\n      if (account?.provider === \"google\" && token.email) {\n        const customer = await prisma.customer.findUnique({\n          where: { email: token.email }\n        })\n\n        if (customer) {\n          token.id = customer.id\n          token.role = \"customer\"\n          token.status = customer.status\n          token.phone = customer.phone\n        } else {\n          // New user - needs to complete registration\n          token.role = \"customer\"\n          token.status = \"NEW\"\n        }\n      }\n\n      // Refresh customer status on session update\n      if (trigger === \"update\" && token.role === \"customer\" && token.id) {\n        const customer = await prisma.customer.findUnique({\n          where: { id: token.id }\n        })\n        if (customer) {\n          token.status = customer.status\n        }\n      }\n\n      return token\n    },\n\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id\n        session.user.role = token.role\n        session.user.phone = token.phone\n        session.user.status = token.status\n      }\n      return session\n    },\n\n    async redirect({ url, baseUrl }) {\n      // Redirect based on role after sign in\n      if (url.startsWith(baseUrl)) {\n        return url\n      }\n      return baseUrl\n    }\n  },\n\n  pages: {\n    signIn: \"/login\",\n    error: \"/login\",\n  },\n\n  session: {\n    strategy: \"jwt\",\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n\n  secret: process.env.NEXTAUTH_SECRET,\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 377, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/api-utils.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { getServerSession } from \"next-auth\"\nimport { authOptions, UserRole } from \"./auth\"\nimport { ZodError } from \"zod\"\n\n// API Response helpers\nexport function successResponse<T>(data: T, status = 200) {\n  return NextResponse.json({ success: true, data }, { status })\n}\n\nexport function errorResponse(message: string, status = 400) {\n  return NextResponse.json({ success: false, error: message }, { status })\n}\n\nexport function validationError(error: ZodError) {\n  const messages = error.errors.map((e) => e.message).join(\", \")\n  return errorResponse(messages, 400)\n}\n\n// Auth helpers\nexport async function getSession() {\n  return getServerSession(authOptions)\n}\n\nexport async function requireAuth(allowedRoles?: UserRole[]) {\n  const session = await getSession()\n  \n  if (!session?.user) {\n    return { error: errorResponse(\"Unauthorized\", 401), session: null }\n  }\n\n  if (allowedRoles && !allowedRoles.includes(session.user.role)) {\n    return { error: errorResponse(\"Forbidden\", 403), session: null }\n  }\n\n  return { error: null, session }\n}\n\nexport async function requireAdmin() {\n  return requireAuth([\"admin\"])\n}\n\nexport async function requireDelivery() {\n  return requireAuth([\"delivery\"])\n}\n\nexport async function requireCustomer() {\n  return requireAuth([\"customer\"])\n}\n\n// Cron job authorization\nexport function verifyCronSecret(request: Request): boolean {\n  const authHeader = request.headers.get(\"authorization\")\n  const cronSecret = process.env.CRON_SECRET\n  \n  if (!cronSecret) {\n    console.error(\"CRON_SECRET not configured\")\n    return false\n  }\n\n  return authHeader === `Bearer ${cronSecret}`\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAIO,SAAS,gBAAmB,IAAO,EAAE,SAAS,GAAG;IACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAM;IAAK,GAAG;QAAE;IAAO;AAC7D;AAEO,SAAS,cAAc,OAAe,EAAE,SAAS,GAAG;IACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,OAAO;IAAQ,GAAG;QAAE;IAAO;AACxE;AAEO,SAAS,gBAAgB,KAAe;IAC7C,MAAM,WAAW,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,IAAM,EAAE,OAAO,EAAE,IAAI,CAAC;IACzD,OAAO,cAAc,UAAU;AACjC;AAGO,eAAe;IACpB,OAAO,IAAA,2JAAgB,EAAC,mIAAW;AACrC;AAEO,eAAe,YAAY,YAAyB;IACzD,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS,MAAM;QAClB,OAAO;YAAE,OAAO,cAAc,gBAAgB;YAAM,SAAS;QAAK;IACpE;IAEA,IAAI,gBAAgB,CAAC,aAAa,QAAQ,CAAC,QAAQ,IAAI,CAAC,IAAI,GAAG;QAC7D,OAAO;YAAE,OAAO,cAAc,aAAa;YAAM,SAAS;QAAK;IACjE;IAEA,OAAO;QAAE,OAAO;QAAM;IAAQ;AAChC;AAEO,eAAe;IACpB,OAAO,YAAY;QAAC;KAAQ;AAC9B;AAEO,eAAe;IACpB,OAAO,YAAY;QAAC;KAAW;AACjC;AAEO,eAAe;IACpB,OAAO,YAAY;QAAC;KAAW;AACjC;AAGO,SAAS,iBAAiB,OAAgB;IAC/C,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,aAAa,QAAQ,GAAG,CAAC,WAAW;IAE1C,IAAI,CAAC,YAAY;QACf,QAAQ,KAAK,CAAC;QACd,OAAO;IACT;IAEA,OAAO,eAAe,CAAC,OAAO,EAAE,YAAY;AAC9C"}},
    {"offset": {"line": 473, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/constants.ts"],"sourcesContent":["// ==================== PRICING CONSTANTS ====================\n\n// Milk pricing (in paise - 100 paise = 1 rupee)\nexport const MILK_PRICE_PER_LITER_PAISE = 11000 // ₹110 per liter\nexport const MILK_PRICE_PER_500ML_PAISE = 5500  // ₹55 per 500ml\n\n// Bottle deposit pricing (in paise)\nexport const DEPOSIT_LARGE_BOTTLE_PAISE = 3500  // ₹35 for 1L bottle\nexport const DEPOSIT_SMALL_BOTTLE_PAISE = 2500  // ₹25 for 500ml bottle\n\n// Penalty pricing (same as deposit)\nexport const PENALTY_LARGE_BOTTLE_PAISE = 3500  // ₹35 penalty\nexport const PENALTY_SMALL_BOTTLE_PAISE = 2500  // ₹25 penalty\n\n// ==================== SUBSCRIPTION CONSTANTS ====================\n\n// Quantity limits (in ml)\nexport const MIN_DAILY_QUANTITY_ML = 500\nexport const MAX_DAILY_QUANTITY_ML = 3000\nexport const QUANTITY_STEP_ML = 500\n\n// Subscription cycles\nexport const DEPOSIT_CYCLE_MONTHS = 3 // Deposit every 3 months\nexport const MIN_SUBSCRIPTION_MONTHS = 1\n\n// Pause limits\nexport const MAX_PAUSE_DAYS_PER_MONTH = 5\n\n// ==================== TIMING CONSTANTS ====================\n\n// Cutoff time for changes (5:00 PM IST previous day)\nexport const CUTOFF_HOUR = 17 // 5 PM in 24-hour format\nexport const CUTOFF_MINUTE = 0\n\n// Delivery time\nexport const DELIVERY_HOUR = 6 // 6 AM\n\n// Grace period for negative balance\nexport const GRACE_PERIOD_DAYS = 1\n\n// Penalty trigger (days without returning bottles)\nexport const PENALTY_TRIGGER_DAYS = 7\n\n// ==================== TIMEZONE ====================\n\nexport const TIMEZONE = 'Asia/Kolkata'\n\n// ==================== BOTTLE COMPOSITION ====================\n\n// Helper to calculate bottle composition from quantity\nexport function calculateBottleComposition(quantityMl: number): {\n  largeBottles: number\n  smallBottles: number\n} {\n  const largeBottles = Math.floor(quantityMl / 1000)\n  const remainingMl = quantityMl % 1000\n  const smallBottles = remainingMl >= 500 ? 1 : 0\n  \n  return { largeBottles, smallBottles }\n}\n\n// Helper to calculate daily price from quantity\nexport function calculateDailyPrice(quantityMl: number): number {\n  const { largeBottles, smallBottles } = calculateBottleComposition(quantityMl)\n  return (largeBottles * MILK_PRICE_PER_LITER_PAISE) + (smallBottles * MILK_PRICE_PER_500ML_PAISE)\n}\n\n// Helper to calculate deposit amount\nexport function calculateDepositAmount(quantityMl: number): number {\n  const { largeBottles, smallBottles } = calculateBottleComposition(quantityMl)\n  return (largeBottles * DEPOSIT_LARGE_BOTTLE_PAISE) + (smallBottles * DEPOSIT_SMALL_BOTTLE_PAISE)\n}\n\n// Helper to calculate monthly total (milk + deposit if applicable)\nexport function calculateMonthlyTotal(\n  quantityMl: number,\n  daysInMonth: number,\n  includeDeposit: boolean\n): { milkTotal: number; depositTotal: number; grandTotal: number } {\n  const dailyPrice = calculateDailyPrice(quantityMl)\n  const milkTotal = dailyPrice * daysInMonth\n  const depositTotal = includeDeposit ? calculateDepositAmount(quantityMl) : 0\n  \n  return {\n    milkTotal,\n    depositTotal,\n    grandTotal: milkTotal + depositTotal\n  }\n}\n\n// Check if deposit is due for a given cycle\nexport function isDepositDue(paymentCycleCount: number): boolean {\n  // Deposit on month 1, 4, 7, 10... (every 3 months)\n  return paymentCycleCount % DEPOSIT_CYCLE_MONTHS === 1\n}\n\n// ==================== QUANTITY OPTIONS ====================\n\nexport const QUANTITY_OPTIONS = [\n  { value: 500, label: '500ml', bottles: '1 small bottle' },\n  { value: 1000, label: '1 Liter', bottles: '1 large bottle' },\n  { value: 1500, label: '1.5 Liters', bottles: '1 large + 1 small bottle' },\n  { value: 2000, label: '2 Liters', bottles: '2 large bottles' },\n  { value: 2500, label: '2.5 Liters', bottles: '2 large + 1 small bottle' },\n  { value: 3000, label: '3 Liters', bottles: '3 large bottles' },\n]\n\n// ==================== STATUS LABELS ====================\n\nexport const CUSTOMER_STATUS_LABELS = {\n  PENDING_APPROVAL: 'Pending Approval',\n  PENDING_PAYMENT: 'Awaiting Payment',\n  ACTIVE: 'Active',\n  PAUSED: 'Paused',\n  BLOCKED: 'Blocked',\n  INACTIVE: 'Inactive',\n}\n\nexport const DELIVERY_STATUS_LABELS = {\n  SCHEDULED: 'Scheduled',\n  DELIVERED: 'Delivered',\n  NOT_DELIVERED: 'Not Delivered',\n  PAUSED: 'Paused',\n  BLOCKED: 'Blocked',\n  HOLIDAY: 'Holiday',\n}\n\n// ==================== FORMAT HELPERS ====================\n\nexport function formatPaise(paise: number): string {\n  const rupees = paise / 100\n  return new Intl.NumberFormat('en-IN', {\n    style: 'currency',\n    currency: 'INR',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 2,\n  }).format(rupees)\n}\n\nexport function formatQuantity(ml: number): string {\n  if (ml >= 1000) {\n    const liters = ml / 1000\n    return `${liters}L`\n  }\n  return `${ml}ml`\n}\n"],"names":[],"mappings":"AAAA,8DAA8D;AAE9D,gDAAgD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACzC,MAAM,6BAA6B,MAAM,iBAAiB;;AAC1D,MAAM,6BAA6B,KAAM,gBAAgB;;AAGzD,MAAM,6BAA6B,KAAM,oBAAoB;;AAC7D,MAAM,6BAA6B,KAAM,uBAAuB;;AAGhE,MAAM,6BAA6B,KAAM,cAAc;;AACvD,MAAM,6BAA6B,KAAM,cAAc;;AAKvD,MAAM,wBAAwB;AAC9B,MAAM,wBAAwB;AAC9B,MAAM,mBAAmB;AAGzB,MAAM,uBAAuB,EAAE,yBAAyB;;AACxD,MAAM,0BAA0B;AAGhC,MAAM,2BAA2B;AAKjC,MAAM,cAAc,GAAG,yBAAyB;;AAChD,MAAM,gBAAgB;AAGtB,MAAM,gBAAgB,EAAE,OAAO;;AAG/B,MAAM,oBAAoB;AAG1B,MAAM,uBAAuB;AAI7B,MAAM,WAAW;AAKjB,SAAS,2BAA2B,UAAkB;IAI3D,MAAM,eAAe,KAAK,KAAK,CAAC,aAAa;IAC7C,MAAM,cAAc,aAAa;IACjC,MAAM,eAAe,eAAe,MAAM,IAAI;IAE9C,OAAO;QAAE;QAAc;IAAa;AACtC;AAGO,SAAS,oBAAoB,UAAkB;IACpD,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,2BAA2B;IAClE,OAAO,AAAC,eAAe,6BAA+B,eAAe;AACvE;AAGO,SAAS,uBAAuB,UAAkB;IACvD,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,2BAA2B;IAClE,OAAO,AAAC,eAAe,6BAA+B,eAAe;AACvE;AAGO,SAAS,sBACd,UAAkB,EAClB,WAAmB,EACnB,cAAuB;IAEvB,MAAM,aAAa,oBAAoB;IACvC,MAAM,YAAY,aAAa;IAC/B,MAAM,eAAe,iBAAiB,uBAAuB,cAAc;IAE3E,OAAO;QACL;QACA;QACA,YAAY,YAAY;IAC1B;AACF;AAGO,SAAS,aAAa,iBAAyB;IACpD,mDAAmD;IACnD,OAAO,oBAAoB,yBAAyB;AACtD;AAIO,MAAM,mBAAmB;IAC9B;QAAE,OAAO;QAAK,OAAO;QAAS,SAAS;IAAiB;IACxD;QAAE,OAAO;QAAM,OAAO;QAAW,SAAS;IAAiB;IAC3D;QAAE,OAAO;QAAM,OAAO;QAAc,SAAS;IAA2B;IACxE;QAAE,OAAO;QAAM,OAAO;QAAY,SAAS;IAAkB;IAC7D;QAAE,OAAO;QAAM,OAAO;QAAc,SAAS;IAA2B;IACxE;QAAE,OAAO;QAAM,OAAO;QAAY,SAAS;IAAkB;CAC9D;AAIM,MAAM,yBAAyB;IACpC,kBAAkB;IAClB,iBAAiB;IACjB,QAAQ;IACR,QAAQ;IACR,SAAS;IACT,UAAU;AACZ;AAEO,MAAM,yBAAyB;IACpC,WAAW;IACX,WAAW;IACX,eAAe;IACf,QAAQ;IACR,SAAS;IACT,SAAS;AACX;AAIO,SAAS,YAAY,KAAa;IACvC,MAAM,SAAS,QAAQ;IACvB,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC,OAAO;QACP,UAAU;QACV,uBAAuB;QACvB,uBAAuB;IACzB,GAAG,MAAM,CAAC;AACZ;AAEO,SAAS,eAAe,EAAU;IACvC,IAAI,MAAM,MAAM;QACd,MAAM,SAAS,KAAK;QACpB,OAAO,GAAG,OAAO,CAAC,CAAC;IACrB;IACA,OAAO,GAAG,GAAG,EAAE,CAAC;AAClB"}},
    {"offset": {"line": 659, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/validations.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { \n  MIN_DAILY_QUANTITY_ML, \n  MAX_DAILY_QUANTITY_ML, \n  QUANTITY_STEP_ML \n} from \"./constants\"\n\n// Customer registration schema\nexport const customerRegistrationSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  phone: z\n    .string()\n    .regex(/^[6-9]\\d{9}$/, \"Please enter a valid 10-digit Indian phone number\"),\n  addressLine1: z.string().min(5, \"Address must be at least 5 characters\"),\n  addressLine2: z.string().optional(),\n  landmark: z.string().optional(),\n  city: z.string().default(\"Pondicherry\"),\n  pincode: z.string().regex(/^[1-9][0-9]{5}$/, \"Please enter a valid 6-digit pincode\"),\n})\n\n// Subscription schema\nexport const subscriptionSchema = z.object({\n  dailyQuantityMl: z\n    .number()\n    .min(MIN_DAILY_QUANTITY_ML, `Minimum quantity is ${MIN_DAILY_QUANTITY_ML}ml`)\n    .max(MAX_DAILY_QUANTITY_ML, `Maximum quantity is ${MAX_DAILY_QUANTITY_ML}ml`)\n    .refine(\n      (val) => val % QUANTITY_STEP_ML === 0,\n      `Quantity must be in steps of ${QUANTITY_STEP_ML}ml`\n    ),\n})\n\n// Pause request schema\nexport const pauseRequestSchema = z.object({\n  dates: z.array(z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Invalid date format\")),\n})\n\n// Wallet top-up schema\nexport const walletTopupSchema = z.object({\n  amountPaise: z.number().min(10000, \"Minimum top-up is ₹100\").max(5000000, \"Maximum top-up is ₹50,000\"),\n})\n\n// Admin - Create delivery person schema\nexport const createDeliveryPersonSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  phone: z\n    .string()\n    .regex(/^[6-9]\\d{9}$/, \"Please enter a valid 10-digit phone number\"),\n  zone: z.string().optional(),\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n})\n\n// Admin - Approve customer schema\nexport const approveCustomerSchema = z.object({\n  customerId: z.string(),\n  deliveryPersonId: z.string(),\n  approved: z.boolean(),\n  rejectionReason: z.string().optional(),\n})\n\n// Admin - Wallet adjustment schema\nexport const walletAdjustmentSchema = z.object({\n  customerId: z.string(),\n  amountPaise: z.number(),\n  description: z.string().min(3, \"Description is required\"),\n  type: z.enum([\"ADMIN_CREDIT\", \"ADMIN_DEBIT\"]),\n})\n\n// Delivery - Mark delivery schema\nexport const markDeliverySchema = z.object({\n  deliveryId: z.string(),\n  status: z.enum([\"DELIVERED\", \"NOT_DELIVERED\"]),\n  largeBottlesCollected: z.number().min(0).default(0),\n  smallBottlesCollected: z.number().min(0).default(0),\n  notes: z.string().optional(),\n})\n\n// Admin login schema\nexport const adminLoginSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(1, \"Password is required\"),\n})\n\n// Admin - Create admin schema\nexport const createAdminSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  password: z.string().min(8, \"Password must be at least 8 characters\"),\n  phone: z.string().optional(),\n})\n\n// Inventory update schema\nexport const inventoryUpdateSchema = z.object({\n  largeBottlesDelta: z.number().default(0),\n  smallBottlesDelta: z.number().default(0),\n  reason: z.string().min(3, \"Reason is required\"),\n})\n\n// Holiday schema\nexport const holidaySchema = z.object({\n  date: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Invalid date format\"),\n  reason: z.string().min(3, \"Reason is required\"),\n})\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;AAOO,MAAM,6BAA6B,oLAAC,CAAC,MAAM,CAAC;IACjD,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,OAAO,oLAAC,CACL,MAAM,GACN,KAAK,CAAC,gBAAgB;IACzB,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAChC,cAAc,oLAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,UAAU,oLAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,MAAM,oLAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IACzB,SAAS,oLAAC,CAAC,MAAM,GAAG,KAAK,CAAC,mBAAmB;AAC/C;AAGO,MAAM,qBAAqB,oLAAC,CAAC,MAAM,CAAC;IACzC,iBAAiB,oLAAC,CACf,MAAM,GACN,GAAG,CAAC,kJAAqB,EAAE,CAAC,oBAAoB,EAAE,kJAAqB,CAAC,EAAE,CAAC,EAC3E,GAAG,CAAC,kJAAqB,EAAE,CAAC,oBAAoB,EAAE,kJAAqB,CAAC,EAAE,CAAC,EAC3E,MAAM,CACL,CAAC,MAAQ,MAAM,6IAAgB,KAAK,GACpC,CAAC,6BAA6B,EAAE,6IAAgB,CAAC,EAAE,CAAC;AAE1D;AAGO,MAAM,qBAAqB,oLAAC,CAAC,MAAM,CAAC;IACzC,OAAO,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,GAAG,KAAK,CAAC,uBAAuB;AACzD;AAGO,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACxC,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,OAAO,0BAA0B,GAAG,CAAC,SAAS;AAC5E;AAGO,MAAM,6BAA6B,oLAAC,CAAC,MAAM,CAAC;IACjD,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,OAAO,oLAAC,CACL,MAAM,GACN,KAAK,CAAC,gBAAgB;IACzB,MAAM,oLAAC,CAAC,MAAM,GAAG,QAAQ;IACzB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAC9B;AAGO,MAAM,wBAAwB,oLAAC,CAAC,MAAM,CAAC;IAC5C,YAAY,oLAAC,CAAC,MAAM;IACpB,kBAAkB,oLAAC,CAAC,MAAM;IAC1B,UAAU,oLAAC,CAAC,OAAO;IACnB,iBAAiB,oLAAC,CAAC,MAAM,GAAG,QAAQ;AACtC;AAGO,MAAM,yBAAyB,oLAAC,CAAC,MAAM,CAAC;IAC7C,YAAY,oLAAC,CAAC,MAAM;IACpB,aAAa,oLAAC,CAAC,MAAM;IACrB,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC/B,MAAM,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAgB;KAAc;AAC9C;AAGO,MAAM,qBAAqB,oLAAC,CAAC,MAAM,CAAC;IACzC,YAAY,oLAAC,CAAC,MAAM;IACpB,QAAQ,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAa;KAAgB;IAC7C,uBAAuB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,OAAO,CAAC;IACjD,uBAAuB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,OAAO,CAAC;IACjD,OAAO,oLAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAGO,MAAM,mBAAmB,oLAAC,CAAC,MAAM,CAAC;IACvC,OAAO,oLAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAC9B;AAGO,MAAM,oBAAoB,oLAAC,CAAC,MAAM,CAAC;IACxC,MAAM,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,OAAO,oLAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,OAAO,oLAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAGO,MAAM,wBAAwB,oLAAC,CAAC,MAAM,CAAC;IAC5C,mBAAmB,oLAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IACtC,mBAAmB,oLAAC,CAAC,MAAM,GAAG,OAAO,CAAC;IACtC,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAC5B;AAGO,MAAM,gBAAgB,oLAAC,CAAC,MAAM,CAAC;IACpC,MAAM,oLAAC,CAAC,MAAM,GAAG,KAAK,CAAC,uBAAuB;IAC9C,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAC5B"}},
    {"offset": {"line": 761, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\nimport { TIMEZONE, CUTOFF_HOUR, CUTOFF_MINUTE } from \"./constants\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n// Get current date in IST\nexport function getISTDate(): Date {\n  return new Date(new Date().toLocaleString('en-US', { timeZone: TIMEZONE }))\n}\n\n// Get IST date string (YYYY-MM-DD)\nexport function getISTDateString(date?: Date): string {\n  const d = date || new Date()\n  return d.toLocaleDateString('en-CA', { timeZone: TIMEZONE }) // en-CA gives YYYY-MM-DD format\n}\n\n// Parse date string to Date object (assumes IST)\nexport function parseISTDate(dateString: string): Date {\n  const [year, month, day] = dateString.split('-').map(Number)\n  return new Date(year, month - 1, day)\n}\n\n// Check if current time is past cutoff (5 PM IST)\nexport function isPastCutoff(): boolean {\n  const now = getISTDate()\n  const currentHour = now.getHours()\n  const currentMinute = now.getMinutes()\n  \n  return currentHour > CUTOFF_HOUR || (currentHour === CUTOFF_HOUR && currentMinute >= CUTOFF_MINUTE)\n}\n\n// Get the earliest date that can be paused (considering cutoff)\nexport function getEarliestPausableDate(): Date {\n  const today = getISTDate()\n  today.setHours(0, 0, 0, 0)\n  \n  // If past cutoff, can't pause tomorrow, only day after\n  const daysToAdd = isPastCutoff() ? 2 : 1\n  today.setDate(today.getDate() + daysToAdd)\n  \n  return today\n}\n\n// Get tomorrow's date in IST\nexport function getTomorrowIST(): Date {\n  const tomorrow = getISTDate()\n  tomorrow.setDate(tomorrow.getDate() + 1)\n  tomorrow.setHours(0, 0, 0, 0)\n  return tomorrow\n}\n\n// Get current month-year string (YYYY-MM)\nexport function getCurrentMonthYear(): string {\n  const now = getISTDate()\n  return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`\n}\n\n// Get days in a specific month\nexport function getDaysInMonth(year: number, month: number): number {\n  return new Date(year, month, 0).getDate()\n}\n\n// Get start and end of current month\nexport function getCurrentMonthRange(): { start: Date; end: Date } {\n  const now = getISTDate()\n  const start = new Date(now.getFullYear(), now.getMonth(), 1)\n  const end = new Date(now.getFullYear(), now.getMonth() + 1, 0)\n  return { start, end }\n}\n\n// Format date for display\nexport function formatDate(date: Date | string): string {\n  const d = typeof date === 'string' ? new Date(date) : date\n  return d.toLocaleDateString('en-IN', {\n    day: 'numeric',\n    month: 'short',\n    year: 'numeric',\n    timeZone: TIMEZONE\n  })\n}\n\n// Format date for display (short)\nexport function formatDateShort(date: Date | string): string {\n  const d = typeof date === 'string' ? new Date(date) : date\n  return d.toLocaleDateString('en-IN', {\n    day: 'numeric',\n    month: 'short',\n    timeZone: TIMEZONE\n  })\n}\n\n// Format datetime for display\nexport function formatDateTime(date: Date | string): string {\n  const d = typeof date === 'string' ? new Date(date) : date\n  return d.toLocaleString('en-IN', {\n    day: 'numeric',\n    month: 'short',\n    year: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n    timeZone: TIMEZONE\n  })\n}\n\n// Generate array of dates for a month\nexport function getMonthDates(year: number, month: number): Date[] {\n  const dates: Date[] = []\n  const daysInMonth = getDaysInMonth(year, month)\n  \n  for (let day = 1; day <= daysInMonth; day++) {\n    dates.push(new Date(year, month - 1, day))\n  }\n  \n  return dates\n}\n\n// Check if two dates are the same day\nexport function isSameDay(date1: Date, date2: Date): boolean {\n  return (\n    date1.getFullYear() === date2.getFullYear() &&\n    date1.getMonth() === date2.getMonth() &&\n    date1.getDate() === date2.getDate()\n  )\n}\n\n// Calculate difference in days between two dates\nexport function daysDifference(date1: Date, date2: Date): number {\n  const oneDay = 24 * 60 * 60 * 1000\n  return Math.round((date2.getTime() - date1.getTime()) / oneDay)\n}\n\n// Validate phone number (Indian format)\nexport function isValidIndianPhone(phone: string): boolean {\n  const cleaned = phone.replace(/\\D/g, '')\n  return /^[6-9]\\d{9}$/.test(cleaned)\n}\n\n// Format phone number for display\nexport function formatPhone(phone: string): string {\n  const cleaned = phone.replace(/\\D/g, '')\n  if (cleaned.length === 10) {\n    return `+91 ${cleaned.slice(0, 5)} ${cleaned.slice(5)}`\n  }\n  return phone\n}\n\n// Validate pincode (Indian format)\nexport function isValidPincode(pincode: string): boolean {\n  return /^[1-9][0-9]{5}$/.test(pincode)\n}\n\n// Generate a random password\nexport function generatePassword(length: number = 8): string {\n  const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n  let password = ''\n  for (let i = 0; i < length; i++) {\n    password += chars.charAt(Math.floor(Math.random() * chars.length))\n  }\n  return password\n}\n\n// Slugify a string\nexport function slugify(text: string): string {\n  return text\n    .toLowerCase()\n    .trim()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/[\\s_-]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,wKAAO,EAAC,IAAA,+IAAI,EAAC;AACtB;AAGO,SAAS;IACd,OAAO,IAAI,KAAK,IAAI,OAAO,cAAc,CAAC,SAAS;QAAE,UAAU,qIAAQ;IAAC;AAC1E;AAGO,SAAS,iBAAiB,IAAW;IAC1C,MAAM,IAAI,QAAQ,IAAI;IACtB,OAAO,EAAE,kBAAkB,CAAC,SAAS;QAAE,UAAU,qIAAQ;IAAC,GAAG,gCAAgC;;AAC/F;AAGO,SAAS,aAAa,UAAkB;IAC7C,MAAM,CAAC,MAAM,OAAO,IAAI,GAAG,WAAW,KAAK,CAAC,KAAK,GAAG,CAAC;IACrD,OAAO,IAAI,KAAK,MAAM,QAAQ,GAAG;AACnC;AAGO,SAAS;IACd,MAAM,MAAM;IACZ,MAAM,cAAc,IAAI,QAAQ;IAChC,MAAM,gBAAgB,IAAI,UAAU;IAEpC,OAAO,cAAc,wIAAW,IAAK,gBAAgB,wIAAW,IAAI,iBAAiB,0IAAa;AACpG;AAGO,SAAS;IACd,MAAM,QAAQ;IACd,MAAM,QAAQ,CAAC,GAAG,GAAG,GAAG;IAExB,uDAAuD;IACvD,MAAM,YAAY,iBAAiB,IAAI;IACvC,MAAM,OAAO,CAAC,MAAM,OAAO,KAAK;IAEhC,OAAO;AACT;AAGO,SAAS;IACd,MAAM,WAAW;IACjB,SAAS,OAAO,CAAC,SAAS,OAAO,KAAK;IACtC,SAAS,QAAQ,CAAC,GAAG,GAAG,GAAG;IAC3B,OAAO;AACT;AAGO,SAAS;IACd,MAAM,MAAM;IACZ,OAAO,GAAG,IAAI,WAAW,GAAG,CAAC,EAAE,OAAO,IAAI,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG,MAAM;AAC9E;AAGO,SAAS,eAAe,IAAY,EAAE,KAAa;IACxD,OAAO,IAAI,KAAK,MAAM,OAAO,GAAG,OAAO;AACzC;AAGO,SAAS;IACd,MAAM,MAAM;IACZ,MAAM,QAAQ,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,IAAI;IAC1D,MAAM,MAAM,IAAI,KAAK,IAAI,WAAW,IAAI,IAAI,QAAQ,KAAK,GAAG;IAC5D,OAAO;QAAE;QAAO;IAAI;AACtB;AAGO,SAAS,WAAW,IAAmB;IAC5C,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,OAAO,EAAE,kBAAkB,CAAC,SAAS;QACnC,KAAK;QACL,OAAO;QACP,MAAM;QACN,UAAU,qIAAQ;IACpB;AACF;AAGO,SAAS,gBAAgB,IAAmB;IACjD,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,OAAO,EAAE,kBAAkB,CAAC,SAAS;QACnC,KAAK;QACL,OAAO;QACP,UAAU,qIAAQ;IACpB;AACF;AAGO,SAAS,eAAe,IAAmB;IAChD,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,OAAO,EAAE,cAAc,CAAC,SAAS;QAC/B,KAAK;QACL,OAAO;QACP,MAAM;QACN,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,UAAU,qIAAQ;IACpB;AACF;AAGO,SAAS,cAAc,IAAY,EAAE,KAAa;IACvD,MAAM,QAAgB,EAAE;IACxB,MAAM,cAAc,eAAe,MAAM;IAEzC,IAAK,IAAI,MAAM,GAAG,OAAO,aAAa,MAAO;QAC3C,MAAM,IAAI,CAAC,IAAI,KAAK,MAAM,QAAQ,GAAG;IACvC;IAEA,OAAO;AACT;AAGO,SAAS,UAAU,KAAW,EAAE,KAAW;IAChD,OACE,MAAM,WAAW,OAAO,MAAM,WAAW,MACzC,MAAM,QAAQ,OAAO,MAAM,QAAQ,MACnC,MAAM,OAAO,OAAO,MAAM,OAAO;AAErC;AAGO,SAAS,eAAe,KAAW,EAAE,KAAW;IACrD,MAAM,SAAS,KAAK,KAAK,KAAK;IAC9B,OAAO,KAAK,KAAK,CAAC,CAAC,MAAM,OAAO,KAAK,MAAM,OAAO,EAAE,IAAI;AAC1D;AAGO,SAAS,mBAAmB,KAAa;IAC9C,MAAM,UAAU,MAAM,OAAO,CAAC,OAAO;IACrC,OAAO,eAAe,IAAI,CAAC;AAC7B;AAGO,SAAS,YAAY,KAAa;IACvC,MAAM,UAAU,MAAM,OAAO,CAAC,OAAO;IACrC,IAAI,QAAQ,MAAM,KAAK,IAAI;QACzB,OAAO,CAAC,IAAI,EAAE,QAAQ,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,QAAQ,KAAK,CAAC,IAAI;IACzD;IACA,OAAO;AACT;AAGO,SAAS,eAAe,OAAe;IAC5C,OAAO,kBAAkB,IAAI,CAAC;AAChC;AAGO,SAAS,iBAAiB,SAAiB,CAAC;IACjD,MAAM,QAAQ;IACd,IAAI,WAAW;IACf,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC/B,YAAY,MAAM,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM;IAClE;IACA,OAAO;AACT;AAGO,SAAS,QAAQ,IAAY;IAClC,OAAO,KACJ,WAAW,GACX,IAAI,GACJ,OAAO,CAAC,aAAa,IACrB,OAAO,CAAC,YAAY,KACpB,OAAO,CAAC,YAAY;AACzB"}},
    {"offset": {"line": 939, "column": 0}, "map": {"version":3,"sources":["file:///Users/tharunkumarl/Full%20Stack/maa-ilay/src/app/api/admin/holidays/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\"\nimport prisma from \"@/lib/prisma\"\nimport { successResponse, errorResponse, validationError, requireAdmin } from \"@/lib/api-utils\"\nimport { holidaySchema } from \"@/lib/validations\"\nimport { parseISTDate } from \"@/lib/utils\"\n\n// Get all holidays\nexport async function GET() {\n  try {\n    const { error } = await requireAdmin()\n    if (error) return error\n\n    const holidays = await prisma.holiday.findMany({\n      where: {\n        date: {\n          gte: new Date()\n        }\n      },\n      orderBy: { date: \"asc\" }\n    })\n\n    return successResponse({ holidays })\n\n  } catch (err) {\n    console.error(\"Get holidays error:\", err)\n    return errorResponse(\"Failed to fetch holidays\", 500)\n  }\n}\n\n// Create holiday (bulk pause for all customers)\nexport async function POST(request: NextRequest) {\n  try {\n    const { error, session } = await requireAdmin()\n    if (error) return error\n\n    const body = await request.json()\n\n    const result = holidaySchema.safeParse(body)\n    if (!result.success) {\n      return validationError(result.error)\n    }\n\n    const { date, reason } = result.data\n    const holidayDate = parseISTDate(date)\n\n    // Check if holiday already exists\n    const existing = await prisma.holiday.findUnique({\n      where: { date: holidayDate }\n    })\n\n    if (existing) {\n      return errorResponse(\"A holiday is already declared for this date\", 400)\n    }\n\n    // Create holiday\n    const holiday = await prisma.holiday.create({\n      data: {\n        date: holidayDate,\n        reason,\n        createdByAdminId: session!.user.id\n      }\n    })\n\n    // Get all active customers\n    const activeCustomers = await prisma.customer.findMany({\n      where: { status: \"ACTIVE\" },\n      select: { id: true }\n    })\n\n    // Create pause for all active customers\n    if (activeCustomers.length > 0) {\n      await prisma.pause.createMany({\n        data: activeCustomers.map(c => ({\n          customerId: c.id,\n          pauseDate: holidayDate,\n          createdByCustomer: false,\n          createdByAdminId: session!.user.id,\n          reason: `Holiday: ${reason}`\n        })),\n        skipDuplicates: true\n      })\n    }\n\n    // Update any scheduled deliveries to HOLIDAY status\n    await prisma.delivery.updateMany({\n      where: {\n        deliveryDate: holidayDate,\n        status: \"SCHEDULED\"\n      },\n      data: {\n        status: \"HOLIDAY\"\n      }\n    })\n\n    // Create audit log\n    await prisma.adminAuditLog.create({\n      data: {\n        adminId: session!.user.id,\n        action: \"holiday_created\",\n        entityType: \"holiday\",\n        entityId: holiday.id,\n        newValue: { date, reason, affectedCustomers: activeCustomers.length }\n      }\n    })\n\n    return successResponse({\n      holiday,\n      affectedCustomers: activeCustomers.length,\n      message: `Holiday declared. ${activeCustomers.length} customers affected.`\n    }, 201)\n\n  } catch (err) {\n    console.error(\"Create holiday error:\", err)\n    return errorResponse(\"Failed to create holiday\", 500)\n  }\n}\n\n// Delete holiday\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { error, session } = await requireAdmin()\n    if (error) return error\n\n    const { searchParams } = new URL(request.url)\n    const date = searchParams.get(\"date\")\n\n    if (!date) {\n      return errorResponse(\"Date is required\", 400)\n    }\n\n    const holidayDate = parseISTDate(date)\n\n    // Delete holiday\n    const holiday = await prisma.holiday.delete({\n      where: { date: holidayDate }\n    })\n\n    // Delete associated pauses (admin-created only)\n    await prisma.pause.deleteMany({\n      where: {\n        pauseDate: holidayDate,\n        createdByCustomer: false\n      }\n    })\n\n    // Revert HOLIDAY deliveries back to SCHEDULED\n    await prisma.delivery.updateMany({\n      where: {\n        deliveryDate: holidayDate,\n        status: \"HOLIDAY\"\n      },\n      data: {\n        status: \"SCHEDULED\"\n      }\n    })\n\n    // Create audit log\n    await prisma.adminAuditLog.create({\n      data: {\n        adminId: session!.user.id,\n        action: \"holiday_deleted\",\n        entityType: \"holiday\",\n        entityId: holiday.id\n      }\n    })\n\n    return successResponse({ message: \"Holiday removed successfully\" })\n\n  } catch (err) {\n    console.error(\"Delete holiday error:\", err)\n    return errorResponse(\"Failed to delete holiday\", 500)\n  }\n}\n"],"names":[],"mappings":"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"}}]
}