{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { withAuth } from \"next-auth/middleware\"\nimport { NextResponse } from \"next/server\"\n\nexport default withAuth(\n  function middleware(req) {\n    const token = req.nextauth.token\n    const path = req.nextUrl.pathname\n\n    // Redirect based on role\n    if (token) {\n      const role = token.role\n\n      // Customer routes\n      if (path.startsWith(\"/customer\")) {\n        if (role !== \"customer\") {\n          return NextResponse.redirect(new URL(`/${role}`, req.url))\n        }\n        // Check if customer needs to complete registration\n        if (token.status === \"NEW\" && !path.startsWith(\"/customer/register\")) {\n          return NextResponse.redirect(new URL(\"/customer/register\", req.url))\n        }\n      }\n\n      // Admin routes\n      if (path.startsWith(\"/admin\")) {\n        if (role !== \"admin\") {\n          return NextResponse.redirect(new URL(`/${role === \"customer\" ? \"customer\" : \"delivery\"}`, req.url))\n        }\n      }\n\n      // Delivery person routes\n      if (path.startsWith(\"/delivery\")) {\n        if (role !== \"delivery\") {\n          return NextResponse.redirect(new URL(`/${role === \"customer\" ? \"customer\" : \"admin\"}`, req.url))\n        }\n      }\n    }\n\n    return NextResponse.next()\n  },\n  {\n    callbacks: {\n      authorized: ({ token, req }) => {\n        const path = req.nextUrl.pathname\n\n        // Public routes that don't need auth\n        const publicRoutes = [\n          \"/\",\n          \"/login\",\n          \"/login/customer\",\n          \"/login/admin\",\n          \"/login/delivery\",\n          \"/api/auth\",\n          \"/api/webhooks\",\n        ]\n\n        // Check if current path is public\n        const isPublicRoute = publicRoutes.some(route => \n          path === route || path.startsWith(route + \"/\")\n        )\n\n        if (isPublicRoute) {\n          return true\n        }\n\n        // Protected routes need token\n        return !!token\n      },\n    },\n  }\n)\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    \"/((?!_next/static|_next/image|favicon.ico|public).*)\",\n  ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;uCAEe,IAAA,8JAAQ,EACrB,SAAS,WAAW,GAAG;IACrB,MAAM,QAAQ,IAAI,QAAQ,CAAC,KAAK;IAChC,MAAM,OAAO,IAAI,OAAO,CAAC,QAAQ;IAEjC,yBAAyB;IACzB,IAAI,OAAO;QACT,MAAM,OAAO,MAAM,IAAI;QAEvB,kBAAkB;QAClB,IAAI,KAAK,UAAU,CAAC,cAAc;YAChC,IAAI,SAAS,YAAY;gBACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,IAAI,GAAG;YAC1D;YACA,mDAAmD;YACnD,IAAI,MAAM,MAAM,KAAK,SAAS,CAAC,KAAK,UAAU,CAAC,uBAAuB;gBACpE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sBAAsB,IAAI,GAAG;YACpE;QACF;QAEA,eAAe;QACf,IAAI,KAAK,UAAU,CAAC,WAAW;YAC7B,IAAI,SAAS,SAAS;gBACpB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,SAAS,aAAa,aAAa,YAAY,EAAE,IAAI,GAAG;YACnG;QACF;QAEA,yBAAyB;QACzB,IAAI,KAAK,UAAU,CAAC,cAAc;YAChC,IAAI,SAAS,YAAY;gBACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,SAAS,aAAa,aAAa,SAAS,EAAE,IAAI,GAAG;YAChG;QACF;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B,GACA;IACE,WAAW;QACT,YAAY,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE;YACzB,MAAM,OAAO,IAAI,OAAO,CAAC,QAAQ;YAEjC,qCAAqC;YACrC,MAAM,eAAe;gBACnB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;YAED,kCAAkC;YAClC,MAAM,gBAAgB,aAAa,IAAI,CAAC,CAAA,QACtC,SAAS,SAAS,KAAK,UAAU,CAAC,QAAQ;YAG5C,IAAI,eAAe;gBACjB,OAAO;YACT;YAEA,8BAA8B;YAC9B,OAAO,CAAC,CAAC;QACX;IACF;AACF;AAGK,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}