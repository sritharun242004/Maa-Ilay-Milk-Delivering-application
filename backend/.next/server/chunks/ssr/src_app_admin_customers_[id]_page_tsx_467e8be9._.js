module.exports=[707,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(33217),e=a.i(70025),f=a.i(37927),g=a.i(50944),h=a.i(210),i=a.i(63519),j=a.i(24987),k=a.i(10227),l=a.i(16201);let m=(0,a.i(70106).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var n=a.i(15618),o=a.i(23025),p=a.i(96221),q=a.i(21007),r=a.i(68114),s=a.i(6704);function t(){return(0,b.jsx)("div",{className:"p-6 lg:p-8",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-xl animate-pulse"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"h-8 w-48 bg-gray-200 rounded animate-pulse"}),(0,b.jsx)("div",{className:"h-4 w-32 bg-gray-200 rounded mt-2 animate-pulse"})]})]}),(0,b.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsx)("div",{className:"h-64 bg-white rounded-2xl animate-pulse"}),(0,b.jsx)("div",{className:"h-48 bg-white rounded-2xl animate-pulse"})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"h-48 bg-white rounded-2xl animate-pulse"}),(0,b.jsx)("div",{className:"h-36 bg-white rounded-2xl animate-pulse"})]})]})]})})}function u({params:a}){let{id:u}=(0,c.use)(a),v=(0,g.useRouter)(),w=(0,f.useQueryClient)(),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)("ADMIN_CREDIT"),{data:J,isLoading:K}=(0,d.useQuery)({queryKey:["admin-customer",u],queryFn:async()=>{let a=await fetch(`/api/admin/customers/${u}`);if(!a.ok)throw Error("Failed to fetch");return a.json()}}),{data:L}=(0,d.useQuery)({queryKey:["delivery-persons"],queryFn:async()=>{let a=await fetch("/api/admin/delivery-persons");if(!a.ok)throw Error("Failed to fetch");return a.json()}}),M=(0,e.useMutation)({mutationFn:async a=>{let b=await fetch(`/api/admin/customers/${u}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({approved:a,deliveryPersonId:B})});if(!b.ok)throw Error((await b.json()).error);return b.json()},onSuccess:()=>{s.default.success("Customer updated"),w.invalidateQueries({queryKey:["admin-customer",u]}),y(!1)},onError:a=>{s.default.error(a.message)}}),N=(0,e.useMutation)({mutationFn:async()=>{let a=await fetch(`/api/admin/customers/${u}/wallet`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amountPaise:100*parseInt(D),description:F,type:H})});if(!a.ok)throw Error((await a.json()).error);return a.json()},onSuccess:()=>{s.default.success("Wallet updated"),w.invalidateQueries({queryKey:["admin-customer",u]}),A(!1),E(""),G("")},onError:a=>{s.default.error(a.message)}});if(K)return(0,b.jsx)(t,{});let O=J?.data?.customer,P=J?.data?.bottleBalance,Q=L?.data?.deliveryPersons||[];return O?(0,b.jsx)("div",{className:"p-6 lg:p-8",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("button",{onClick:()=>v.back(),className:"w-10 h-10 flex items-center justify-center rounded-xl bg-gray-100 hover:bg-gray-200 transition-colors",children:(0,b.jsx)(h.ArrowLeft,{className:"w-5 h-5 text-gray-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:O.name}),(0,b.jsx)("p",{className:"text-gray-500",children:O.email})]}),(0,b.jsx)("span",{className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-semibold ${"ACTIVE"===O.status?"bg-emerald-100 text-emerald-800":"PENDING_APPROVAL"===O.status?"bg-amber-100 text-amber-800":"BLOCKED"===O.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:q.CUSTOMER_STATUS_LABELS[O.status]})]}),"PENDING_APPROVAL"===O.status&&(0,b.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-amber-800 mb-4",children:"Pending Approval"}),x?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Delivery Person"}),(0,b.jsxs)("select",{value:B,onChange:a=>C(a.target.value),className:"w-full h-11 px-4 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[(0,b.jsx)("option",{value:"",children:"Select delivery person..."}),Q.filter(a=>a.isActive).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.zone||"No zone",")"]},a.id))]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("button",{onClick:()=>M.mutate(!0),disabled:!B||M.isPending,className:"inline-flex items-center gap-2 px-5 py-2.5 bg-slate-900 text-white font-medium rounded-xl hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[M.isPending&&(0,b.jsx)(p.Loader2,{className:"w-4 h-4 animate-spin"}),"Confirm Approval"]}),(0,b.jsx)("button",{onClick:()=>y(!1),className:"px-5 py-2.5 text-gray-600 font-medium hover:bg-amber-100 rounded-xl transition-colors",children:"Cancel"})]})]}):(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("button",{onClick:()=>y(!0),className:"inline-flex items-center gap-2 px-5 py-2.5 bg-emerald-600 text-white font-medium rounded-xl hover:bg-emerald-700 transition-colors",children:[(0,b.jsx)(l.CheckCircle,{className:"w-4 h-4"}),"Approve"]}),(0,b.jsxs)("button",{onClick:()=>M.mutate(!1),className:"inline-flex items-center gap-2 px-5 py-2.5 border border-red-200 text-red-600 font-medium rounded-xl hover:bg-red-50 transition-colors",children:[(0,b.jsx)(m,{className:"w-4 h-4"}),"Reject"]})]})]}),(0,b.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-5 border-b border-gray-200",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Contact Information"})}),(0,b.jsxs)("div",{className:"p-6 space-y-5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(i.Phone,{className:"w-5 h-5 text-gray-500"})}),(0,b.jsx)("span",{className:"text-gray-900",children:(0,r.formatPhone)(O.phone)})]}),(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(j.MapPin,{className:"w-5 h-5 text-gray-500"})}),(0,b.jsxs)("div",{className:"text-gray-900",children:[(0,b.jsx)("p",{children:O.addressLine1}),O.addressLine2&&(0,b.jsx)("p",{children:O.addressLine2}),O.landmark&&(0,b.jsxs)("p",{className:"text-gray-500",children:["Near ",O.landmark]}),(0,b.jsxs)("p",{children:[O.city," - ",O.pincode]})]})]}),O.deliveryPerson&&(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(k.Truck,{className:"w-5 h-5 text-blue-600"})}),(0,b.jsxs)("span",{className:"text-gray-900",children:["Assigned to: ",(0,b.jsx)("strong",{children:O.deliveryPerson.name}),O.deliveryPerson.zone&&` (${O.deliveryPerson.zone})`]})]})]})]}),O.subscription&&(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-5 border-b border-gray-200",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Subscription"})}),(0,b.jsx)("div",{className:"p-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Daily Quantity"}),(0,b.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:(0,q.formatQuantity)(O.subscription.dailyQuantityMl)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Daily Price"}),(0,b.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:(0,q.formatPaise)(O.subscription.dailyPricePaise)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Current Cycle"}),(0,b.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["Month ",O.subscription.paymentCycleCount]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Status"}),(0,b.jsx)("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${"ACTIVE"===O.subscription.status?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-800"}`,children:O.subscription.status})]})]})})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-5 border-b border-gray-200",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Deliveries"})}),(0,b.jsx)("div",{className:"p-6",children:O.deliveries?.length===0?(0,b.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No deliveries yet"}):(0,b.jsx)("div",{className:"space-y-3",children:O.deliveries?.slice(0,10).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:(0,r.formatDate)(a.deliveryDate)}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:(0,q.formatQuantity)(a.quantityMl)})]}),(0,b.jsx)("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${"DELIVERED"===a.status?"bg-emerald-100 text-emerald-800":"PAUSED"===a.status?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:q.DELIVERY_STATUS_LABELS[a.status]})]},a.id))})})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsxs)("div",{className:"px-6 py-5 border-b border-gray-200 flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Wallet"}),(0,b.jsx)("button",{onClick:()=>A(!0),className:"px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:"Adjust"})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("p",{className:`text-4xl font-bold ${0>(O.wallet?.balancePaise||0)?"text-red-600":"text-gray-900"}`,children:(0,q.formatPaise)(O.wallet?.balancePaise||0)}),z&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-2 p-1 bg-gray-100 rounded-xl",children:[(0,b.jsxs)("button",{onClick:()=>I("ADMIN_CREDIT"),className:`flex-1 flex items-center justify-center gap-1.5 py-2 rounded-lg text-sm font-medium transition-colors ${"ADMIN_CREDIT"===H?"bg-white text-emerald-700 shadow-sm":"text-gray-600"}`,children:[(0,b.jsx)(n.Plus,{className:"w-4 h-4"}),"Credit"]}),(0,b.jsxs)("button",{onClick:()=>I("ADMIN_DEBIT"),className:`flex-1 flex items-center justify-center gap-1.5 py-2 rounded-lg text-sm font-medium transition-colors ${"ADMIN_DEBIT"===H?"bg-white text-red-700 shadow-sm":"text-gray-600"}`,children:[(0,b.jsx)(o.Minus,{className:"w-4 h-4"}),"Debit"]})]}),(0,b.jsx)("input",{type:"number",placeholder:"Amount in rupees",value:D,onChange:a=>E(a.target.value),className:"w-full h-10 px-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"}),(0,b.jsx)("input",{type:"text",placeholder:"Reason/Description",value:F,onChange:a=>G(a.target.value),className:"w-full h-10 px-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>N.mutate(),disabled:!D||!F||N.isPending,className:"flex-1 h-10 px-4 bg-slate-900 text-white rounded-lg text-sm font-medium hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:N.isPending?"Saving...":"Save"}),(0,b.jsx)("button",{onClick:()=>A(!1),className:"h-10 px-4 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Cancel"})]})]}),O.wallet?.transactions?.length>0&&!z&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Recent"}),(0,b.jsx)("div",{className:"space-y-2",children:O.wallet.transactions.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600 truncate flex-1 mr-3",children:a.description}),(0,b.jsxs)("span",{className:`font-semibold ${a.amountPaise>0?"text-emerald-600":"text-red-600"}`,children:[a.amountPaise>0?"+":"",(0,q.formatPaise)(a.amountPaise)]})]},a.id))})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-5 border-b border-gray-200",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Bottles with Customer"})}),(0,b.jsxs)("div",{className:"p-6 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"1L Bottles"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:P?.large||0})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"500ml Bottles"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:P?.small||0})]})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-5 border-b border-gray-200",children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Account Info"})}),(0,b.jsxs)("div",{className:"p-6 space-y-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Created"}),(0,b.jsx)("span",{className:"text-gray-900 font-medium",children:(0,r.formatDate)(O.createdAt)})]}),O.approvedAt&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Approved"}),(0,b.jsx)("span",{className:"text-gray-900 font-medium",children:(0,r.formatDate)(O.approvedAt)})]})]})]})]})]})]})}):(0,b.jsx)("div",{className:"p-6 lg:p-8",children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,b.jsx)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-12 text-center",children:(0,b.jsx)("p",{className:"text-gray-500",children:"Customer not found"})})})})}a.s(["default",()=>u],707)}];

//# sourceMappingURL=src_app_admin_customers_%5Bid%5D_page_tsx_467e8be9._.js.map